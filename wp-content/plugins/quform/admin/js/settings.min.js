var quform=function(e,f,t,l){"use strict";var b,d=e.core,a=d.cache,s=f(window),i=f(document),c=!1,o=null,n=!1,r=!1,_=!1;return f((b={init:function(){f.fn.tctabs&&(a.get("#qfb-settings-tabs").tctabs(".qfb-tabs-panel",{tabs:"> .qfb-tabs-nav > li",current:"qfb-current-tab"}),"#license-updates"===window.location.hash&&a.get("#qfb-settings-tabs").data("tabs").click(1),a.get("#qfb-custom-css-tabs").tctabs(".qfb-tabs-panel",{tabs:"> .qfb-tabs-nav > li",current:"qfb-current-tab"})),f("form.qfb-settings-form input").on("keydown",function(e){13==e.keyCode&&e.preventDefault()}),a.get("#qfb_load_scripts").change(function(){a.get("#qfb_load_scripts_custom").closest(d.settingWrap)["custom"==f(this).val()?"qfbSlideShow":"qfbSlideHide"]()}),f.fn.select2&&a.get("#qfb_locale").add(a.get("#qfb_load_scripts_custom")).select2({theme:"qfb",language:{noResults:function(){return l.noResultsFound}}}),a.get("#qfb-save-settings").add(a.get("#qfb-fixed-save-button")).click(function(){b.validateSettings()&&b.saveSettings()}),a.get("#qfb-settings-verify").click(b.verifyPurchaseCode),a.get("#qfb-settings-update").click(b.checkForUpdates),a.get("#qfb-rebuild-script-cache").click(b.rebuildScriptCache),f(".qfb-permissions-role-name").click(function(){f(this).closest(".qfb-table-row").find(".qfb-permissions-capability").each(function(){this.checked=!this.checked})}),i.on("heartbeat-tick",function(e,s){s&&s.nonces_expired&&(s.quformSaveSettingsNonce&&t.saveSettingsNonce!==s.quformSaveSettingsNonce&&(t.saveSettingsNonce=s.quformSaveSettingsNonce),s.quformUpdateCheckNonce&&t.updateCheckNonce!==s.quformUpdateCheckNonce&&(t.updateCheckNonce=s.quformUpdateCheckNonce),s.quformVerifyNonce&&t.verifyNonce!==s.quformVerifyNonce&&(t.verifyNonce=s.quformVerifyNonce),s.quformRebuildScriptCacheNonce&&t.rebuildScriptCacheNonce!==s.quformRebuildScriptCacheNonce&&(t.rebuildScriptCacheNonce=s.quformRebuildScriptCacheNonce))})},activateTab:function(e){a.get("#qfb-settings-tabs").data("tabs").click(e)},validateSettings:function(){f(".qfb-validation-error").remove();var e=[],s=f("#qfb_default_email_address"),a=s.val(),t="";d.isNonEmptyString(a)?d.isValidEmail(a)||(t=l.invalidEmailAddress):t=l.thisFieldIsRequired,t.length&&e.push({scrollTarget:s.closest(d.settingWrap),show:function(){d.addValidationError(s.closest(".qfb-settings-column"),t)},tab:0});var i=f("#qfb_default_from_email_address"),c=i.val(),o="";d.isNonEmptyString(c)?d.isValidEmail(c)||(o=l.invalidEmailAddress):o=l.thisFieldIsRequired,o.length&&e.push({scrollTarget:i.closest(d.settingWrap),show:function(){d.addValidationError(i.closest(".qfb-settings-column"),o)},tab:0});var n=0,r=e.length;if(0<r){for(b.activateTab(e[0].tab);n<r;n++)e[n].show();d.scrollTo(e[0].scrollTarget)}return 0===r},saveSettings:function(){c||(c=!0,a.get("#qfb-settings-save-loading").show().animate({maxWidth:"43px"}),"number"==typeof o&&(clearTimeout(o),o=null),a.get("#qfb-fixed-save-button").removeClass("qfb-saving qfb-saved qfb-save-error").addClass("qfb-saving"),f.ajax({type:"POST",url:l.ajaxUrl,data:{action:"quform_save_settings",_ajax_nonce:t.saveSettingsNonce,options:JSON.stringify(b.getSettings())},dataType:"json"}).done(function(e){"success"==(e=d.sanitizeResponse(e)).type?b.onSaveSuccess():b.onSaveError(e.message)}).fail(function(){b.onSaveError(l.ajaxError)}).always(function(){c=!1,a.get("#qfb-settings-save-loading").animate({maxWidth:"0"}).hide()}))},getSettings:function(){var t={defaultEmailAddress:f("#qfb_default_email_address").val(),defaultEmailName:f("#qfb_default_email_name").val(),defaultFromEmailAddress:f("#qfb_default_from_email_address").val(),defaultFromEmailName:f("#qfb_default_from_email_name").val(),locale:f("#qfb_locale").val(),dateFormatJs:f("#qfb_date_format_js").val(),timeFormatJs:f("#qfb_time_format_js").val(),dateTimeFormatJs:f("#qfb_date_time_format_js").val(),dateFormat:f("#qfb_date_format").val(),timeFormat:f("#qfb_time_format").val(),dateTimeFormat:f("#qfb_date_time_format").val(),rtl:f("#qfb_rtl").val(),recaptchaSiteKey:f("#qfb_recaptcha_site_key").val(),recaptchaSecretKey:f("#qfb_recaptcha_secret_key").val(),customCss:f("#qfb_custom_css").val(),customCssTablet:f("#qfb_custom_css_tablet").val(),customCssPhone:f("#qfb_custom_css_phone").val(),customJs:f("#qfb_custom_js").val(),loadScripts:f("#qfb_load_scripts").val(),loadScriptsCustom:f("#qfb_load_scripts_custom").val(),disabledStyles:{fontAwesome:!f("#qfb_enable_style_font_awesome").is(":checked"),select2:!f("#qfb_enable_style_select2").is(":checked"),qtip:!f("#qfb_enable_style_qtip").is(":checked"),fancybox:!f("#qfb_enable_style_fancybox").is(":checked"),fancybox2:!f("#qfb_enable_style_fancybox2").is(":checked"),magnificPopup:!f("#qfb_enable_style_magnific_popup").is(":checked")},disabledScripts:{fileUpload:!f("#qfb_enable_script_file_upload").is(":checked"),scrollTo:!f("#qfb_enable_script_scroll_to").is(":checked"),select2:!f("#qfb_enable_script_select2").is(":checked"),qtip:!f("#qfb_enable_script_qtip").is(":checked"),fancybox:!f("#qfb_enable_script_fancybox").is(":checked"),fancybox2:!f("#qfb_enable_script_fancybox2").is(":checked"),magnificPopup:!f("#qfb_enable_script_magnific_popup").is(":checked"),infieldLabels:!f("#qfb_enable_script_infield_labels").is(":checked"),datepicker:!f("#qfb_enable_script_datepicker").is(":checked"),timepicker:!f("#qfb_enable_script_timepicker").is(":checked")},combineCss:f("#qfb_combine_css").is(":checked"),combineJs:f("#qfb_combine_js").is(":checked"),popupEnabled:f("#qfb_popup_enabled").is(":checked"),popupScript:f("#qfb_popup_script").val(),rawFix:f("#qfb_raw_fix").is(":checked"),scrollOffset:f("#qfb_scroll_offset").val(),scrollSpeed:f("#qfb_scroll_speed").val(),allowAllFileTypes:f("#qfb_allow_all_file_types").is(":checked"),showEditLink:f("#qfb_show_edit_link").is(":checked"),csrfProtection:f("#qfb_csrf_protection").is(":checked"),supportPageCaching:f("#qfb_support_page_caching").is(":checked"),toolbarMenu:f("#qfb_toolbar_menu").is(":checked"),dashboardWidget:f("#qfb_dashboard_widget").is(":checked"),insertFormButton:f("#qfb_insert_form_button").is(":checked"),preventFouc:f("#qfb_prevent_fouc").is(":checked"),secureApiRequests:f("#qfb_secure_api_requests").is(":checked"),saveIpAddresses:f("#qfb_save_ip_addresses").is(":checked"),alwaysShowFullDates:f("#qfb_always_show_full_dates").is(":checked"),referralEnabled:f("#qfb_referral_enabled").is(":checked"),referralText:f("#qfb_referral_text").val(),referralUsername:f("#qfb_referral_username").val()};return f.isArray(t.loadScriptsCustom)||(t.loadScriptsCustom=[]),t.permissions={},f(".qfb-permissions-capability").each(function(){var e=f(this),s=e.data("role"),a=e.data("capability");"undefined"==typeof t.permissions[s]&&(t.permissions[s]={}),t.permissions[s][a]=e.is(":checked")}),t},onSaveSuccess:function(){d.showFixedMessage(t.settingsSaved,"success"),a.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-saved"),o=setTimeout(function(){a.get("#qfb-fixed-save-button").removeClass("qfb-saved")},2e3)},onSaveError:function(e){d.showFixedMessage(t.errorSavingSettings+"<br>"+e,"error"),a.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error"),o=setTimeout(function(){a.get("#qfb-fixed-save-button").removeClass("qfb-save-error")},2e3)},checkForUpdates:function(){n?alert(t.waitUpdating):(n=!0,a.get("#qfb-settings-update-loading").show().animate({maxWidth:"43px"}),f.ajax({type:"POST",url:l.ajaxUrl,data:{action:"quform_manual_update_check",_ajax_nonce:t.updateCheckNonce},dataType:"json"}).done(function(e){"success"==(e=d.sanitizeResponse(e)).type?b.onUpdateSuccess(e.message):b.onUpdateError(e.message)}).fail(function(){b.onUpdateError(l.ajaxError)}).always(function(){a.get("#qfb-settings-update-loading").animate({maxWidth:"0"}).hide(),n=!1}))},showUpdateMessage:function(e,s){a.get("#qfb-settings-update-message").hide(),a.get("#qfb-settings-update-message").find(".qfb-message-box").removeClass("qfb-message-box-success qfb-message-box-error").addClass("qfb-message-box-"+s),a.get("#qfb-settings-update-message").find(".qfb-message-box-inner").html(e),a.get("#qfb-settings-update-message").qfbSlideShow()},onUpdateSuccess:function(e){b.showUpdateMessage(e,"success")},onUpdateError:function(e){e=t.errorCheckingForUpdate+(e?" ("+e+")":""),b.showUpdateMessage(e,"error")},verifyPurchaseCode:function(){if(r)alert(t.waitVerifying);else{var e=f("#qfb_purchase_code").val();e.length&&(r=!0,a.get("#qfb-settings-verify-loading").show().animate({maxWidth:"43px"}),f.ajax({type:"POST",url:l.ajaxUrl,data:{action:"quform_verify_purchase_code",_ajax_nonce:t.verifyNonce,purchase_code:e},dataType:"json"}).done(function(e){if("success"==(e=d.sanitizeResponse(e)).type?b.onVerificationSuccess(e.message):"error"!=e.type&&"invalid"!=e.type||b.showVerificationMessage(e.message,"error"),"string"==typeof e.status){var s=f(".qfb-license-status"),a=s.find(".qfb-message-box");"valid"!==e.status&&"bundled"!==e.status||!a.hasClass("qfb-message-box-error")?"unlicensed"===e.status&&a.hasClass("qfb-message-box-success")&&s.fadeOut(function(){a.removeClass("qfb-message-box-success").addClass("qfb-message-box-error").find(".qfb-message-box-inner").text(t.unlicensed),s.fadeIn()}):s.fadeOut(function(){a.removeClass("qfb-message-box-error").addClass("qfb-message-box-success").find(".qfb-message-box-inner").text(t[e.status]),s.fadeIn()})}}).fail(function(){b.onVerificationError(l.ajaxError)}).always(function(){a.get("#qfb-settings-verify-loading").animate({maxWidth:"0"}).hide(),r=!1}))}},showVerificationMessage:function(e,s){a.get("#qfb-settings-verify-message").hide(),a.get("#qfb-settings-verify-message").find(".qfb-message-box").removeClass("qfb-message-box-success qfb-message-box-error").addClass("qfb-message-box-"+s),a.get("#qfb-settings-verify-message").find(".qfb-message-box-inner").html(e),a.get("#qfb-settings-verify-message").qfbSlideShow()},onVerificationSuccess:function(e){b.showVerificationMessage(e,"success")},onVerificationError:function(e){e=t.errorVerifying+(e?" ("+e+")":""),b.showVerificationMessage(e,"error")},rebuildScriptCache:function(){_||(_=!0,a.get("#qfb-rebuild-script-cache-loading").show().animate({maxWidth:"43px"}),f.ajax({type:"POST",url:l.ajaxUrl,data:{action:"quform_rebuild_script_cache",_ajax_nonce:t.rebuildScriptCacheNonce},dataType:"json"}).done(function(e){"success"==(e=d.sanitizeResponse(e)).type?d.showFixedMessage(t.scriptCacheRebuilt,"success"):b.onRebuildScriptCacheError(e.message)}).fail(function(){b.onRebuildScriptCacheError(l.ajaxError)}).always(function(){_=!1,a.get("#qfb-rebuild-script-cache-loading").animate({maxWidth:"0"}).hide()}))},onRebuildScriptCacheError:function(e){d.showFixedMessage(t.errorRebuildingScriptCache+"<br>"+e,"error")},onWindowLoad:function(){b.setupTooltips(),a.get("#qfb_popup_script").change(b.setDisableableScriptVisibility),a.get("#qfb_popup_enabled").click(function(){f("#qfb_popup_script").closest(d.settingWrap)[f(this).is(":checked")?"qfbSlideShow":"qfbSlideHide"](),b.setDisableableScriptVisibility()})},setupTooltips:function(){"function"==typeof f.fn.qtip&&f(".qfb-disableable-script-tooltip").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return f(this).find(".qfb-tooltip-content").html()}},position:{viewport:!0}})},setDisableableScriptVisibility:function(){if(a.get("#qfb_popup_enabled").is(":checked"))switch(a.get("#qfb_popup_script").val()){case"fancybox-2":a.get("#qfb_enable_style_fancybox").add(a.get("#qfb_enable_style_magnific_popup")).add(a.get("#qfb_enable_script_fancybox")).add(a.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide(),a.get("#qfb_enable_style_fancybox2").add(a.get("#qfb_enable_script_fancybox2")).closest(".qfb-disableable-script").show();break;case"fancybox-1":a.get("#qfb_enable_style_fancybox2").add(a.get("#qfb_enable_style_magnific_popup")).add(a.get("#qfb_enable_script_fancybox2")).add(a.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide(),a.get("#qfb_enable_style_fancybox").add(a.get("#qfb_enable_script_fancybox")).closest(".qfb-disableable-script").show();break;case"magnific-popup":a.get("#qfb_enable_style_fancybox").add(a.get("#qfb_enable_style_fancybox2")).add(a.get("#qfb_enable_script_fancybox")).add(a.get("#qfb_enable_script_fancybox2")).closest(".qfb-disableable-script").hide(),a.get("#qfb_enable_style_magnific_popup").add(a.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").show()}else a.get("#qfb_enable_style_fancybox").add(a.get("#qfb_enable_style_fancybox2")).add(a.get("#qfb_enable_style_magnific_popup")).add(a.get("#qfb_enable_script_fancybox")).add(a.get("#qfb_enable_script_fancybox2")).add(a.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide()}}).init),s.on("load",b.onWindowLoad),e.settings=b,e}(quform||{},jQuery,quformSettingsL10n,quformCoreL10n);