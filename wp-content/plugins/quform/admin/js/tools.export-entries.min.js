var quform=function(e,n,t,i){"use strict";var o,a=e.core,s=a.cache;return n((o={init:function(){o.setupTooltips(),o.setupDatepickers(),s.get("#qfb-export-entries-form-id").change(function(){o.getFieldList()}).change(),s.get("#qfb-export-all-fields").click(function(){n(".qfb-export-field").prop("checked",n(this).is(":checked"))}),s.get("#qfb_format_type").change(function(){s.get("#qfb-export-entries-csv-settings")["csv"==s.get("#qfb_format_type").val()?"qfbSlideShow":"qfbSlideHide"]()}),s.get("#qfb_format_csv_excel_compatibility").change(function(){s.get("#qfb_format_csv_delimiter").add(s.get("#qfb_format_csv_enclosure")).add(s.get("#qfb_format_csv_use_bom")).add(s.get("#qfb_format_csv_line_endings")).closest(a.settingWrap)[s.get("#qfb_format_csv_excel_compatibility").is(":checked")?"qfbSlideHide":"qfbSlideShow"]()}),s.get("#qfb_format_csv_delimiter").change(function(){s.get("#qfb_format_csv_delimiter_custom").closest(a.subSettingWrap)["custom"==s.get("#qfb_format_csv_delimiter").val()?"qfbSlideShow":"qfbSlideHide"]()}),s.get("#qfb_format_csv_enclosure").change(function(){s.get("#qfb_format_csv_enclosure_custom").closest(a.subSettingWrap)["custom"==s.get("#qfb_format_csv_enclosure").val()?"qfbSlideShow":"qfbSlideHide"]()}),n.fn.sortable&&s.get("#qfb-export-entries-fields").sortable({stop:function(){var e=[];s.get("#qfb-export-entries-fields").find(".qfb-export-field").each(function(){e.push(n(this).val())}),n.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_save_export_field_list_order",form_id:s.get("#qfb-export-entries-form-id").val(),fields:JSON.stringify(e)}})}})},setupTooltips:function(){n.isFunction(n.fn.qtip)&&n(".qfb-tooltip-icon").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return n(this).find(".qfb-tooltip-content").html()}},position:{viewport:!0},hide:{fixed:!0}})},setupDatepickers:function(){if(n.isFunction(n.fn.kendoDatePicker)){var i=s.get("#qfb_date_from").kendoDatePicker({format:"yyyy-MM-dd",change:function(){var e=i.value(),t=o.value();e?((e=new Date(e)).setDate(e.getDate()),o.min(e)):(t?i.max(new Date(t)):i.max(new Date(2099,11,31)),o.min(new Date(1900,0,1)))}}).data("kendoDatePicker"),o=s.get("#qfb_date_to").kendoDatePicker({format:"yyyy-MM-dd",change:function(){var e=o.value(),t=i.value();e?((e=new Date(e)).setDate(e.getDate()),i.max(e)):t?(o.min(new Date(t)),i.max(new Date(2099,11,31))):(i.max(new Date(2099,11,31)),o.min(new Date(1900,0,1)))}}).data("kendoDatePicker");s.get("#qfb_date_from").on("click focus",function(){i.open()}),s.get("#qfb_date_to").on("click focus",function(){o.open()})}},getFieldList:function(){s.get("#qfb-export-entries-fields-wrap").hide(),s.get("#qfb-export-entries-fields").empty(),s.get("#qfb-export-all-fields").prop("checked",!1),""!=s.get("#qfb-export-entries-form-id").val()&&(s.get(".qfb-export-entries-loading").show(),n.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_get_export_field_list",form_id:s.get("#qfb-export-entries-form-id").val()},dataType:"json"}).done(function(e){switch((e=a.sanitizeResponse(e)).type){case"success":o.onFieldListSuccess(e.data);break;case"error":case"invalid":o.onFieldListFail(e.message)}}).fail(function(){o.onFieldListFail(i.ajaxError)}).always(function(){s.get(".qfb-export-entries-loading").hide()}))},onFieldListSuccess:function(e){for(var t=0;t<e.length;t++)s.get("#qfb-export-entries-fields").append(o.getFieldListItemHtml(e[t]));s.get("#qfb-export-entries-fields-wrap").show()},getFieldListItemHtml:function(e){var t,i=n('<div class="qfb-export-single-field">');return i.append(n("<label>").append(n('<input class="qfb-export-field" type="checkbox" name="qfb_columns[]">').val(e.value),t=n('<span class="qfb-export-field-text">').append(n('<span class="qfb-export-field-label">').text(e.label)))),e.identifier&&t.append(n('<span class="qfb-export-field-identifier">').text("("+e.identifier+")")),i},onFieldListFail:function(e){a.showFixedMessage(t.errorExportingEntries+"<br>"+e,"error")}}).init),e.tools=e.tools||{},e.tools.exportEntries=o,e}(quform,jQuery,quformToolsExportEntriesL10n,quformCoreL10n);